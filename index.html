<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Show my location in Google Maps iframe</title>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        margin: 1rem;
      }
      #mapWrapper {
        width: 100%;
        max-width: 900px;
        height: 500px;
        border: 1px solid #ddd;
        margin-top: 1rem;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: 0;
      }
      #info {
        margin-top: 0.5rem;
        color: #333;
      }
      button {
        padding: 0.5rem 1rem;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>Share location & show Google Map</h1>
    <p>
      Click the button to request your location from the browser. You will be
      asked to allow access.
    </p>

    <button id="locBtn">Get my location and show on map</button>
    <div id="info"></div>

    <div id="mapWrapper" aria-hidden="true">
      <!-- placeholder iframe; we'll update src dynamically -->
      <iframe
        id="mapFrame"
        src="about:blank"
        title="Map showing your location"
      ></iframe>
    </div>

    <script>
      const locBtn = document.getElementById("locBtn");
      const info = document.getElementById("info");
      const mapFrame = document.getElementById("mapFrame");

      function setStatus(text, isError = false) {
        info.textContent = text;
        info.style.color = isError ? "crimson" : "#333";
      }

      async function getLocationAndShowMap() {
        // Ensure geolocation is supported
        if (!("geolocation" in navigator)) {
          setStatus("Geolocation is not supported by your browser.", true);
          return;
        }

        setStatus("Requesting locationâ€¦");

        const options = {
          enableHighAccuracy: false, // set true if you need better accuracy (may take longer)
          timeout: 15000,
          maximumAge: 60_000,
        };

        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude.toFixed(6);
            const lng = position.coords.longitude.toFixed(6);
            setStatus(`Location found: ${lat}, ${lng}`);

            // Option A: quick embed (no API key)
            const urlNoKey = `https://www.google.com/maps?q=${lat},${lng}&z=15&output=embed`;

            // Option B: embed using Maps Embed API (requires API key)
            // const apiKey = 'YOUR_API_KEY_HERE';
            // const urlWithKey = `https://www.google.com/maps/embed/v1/view?key=${apiKey}&center=${lat},${lng}&zoom=16`;

            // Use the no-key url by default
            mapFrame.setAttribute("src", urlNoKey);
            mapFrame.setAttribute("aria-hidden", "false");
          },
          (err) => {
            // handle errors
            switch (err.code) {
              case err.PERMISSION_DENIED:
                setStatus(
                  "Permission denied. Please allow location access in your browser.",
                  true
                );
                break;
              case err.POSITION_UNAVAILABLE:
                setStatus("Position unavailable. Try again later.", true);
                break;
              case err.TIMEOUT:
                setStatus("Location request timed out. Try again.", true);
                break;
              default:
                setStatus(
                  "An unknown error occurred while getting location.",
                  true
                );
            }
          },
          options
        );
      }

      locBtn.addEventListener("click", getLocationAndShowMap);
    </script>
  </body>
</html>
